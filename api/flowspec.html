<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EYFXNGNGB6"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-EYFXNGNGB6",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Metaflow Docs" href="/opensearch.xml"><title data-react-helmet="true">FlowSpec - Constructing flows | Metaflow Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://docs.metaflow.org/img/Metaflow_Logo_Vertical_FullColor_Ribbon_Dark_RGB.png"><meta data-react-helmet="true" name="twitter:image" content="https://docs.metaflow.org/img/Metaflow_Logo_Vertical_FullColor_Ribbon_Dark_RGB.png"><meta data-react-helmet="true" property="og:url" content="https://docs.metaflow.org/api/flowspec"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="FlowSpec - Constructing flows | Metaflow Docs"><meta data-react-helmet="true" name="description" content="Metaflow flows are defined by inhering from the FlowSpec class:"><meta data-react-helmet="true" property="og:description" content="Metaflow flows are defined by inhering from the FlowSpec class:"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.metaflow.org/api/flowspec"><link data-react-helmet="true" rel="alternate" href="https://docs.metaflow.org/api/flowspec" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.metaflow.org/api/flowspec" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://5IZ8L9TJQL-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.eb8bddc4.css">
<link rel="preload" href="/assets/js/runtime~main.b7d466f4.js" as="script">
<link rel="preload" href="/assets/js/main.a5c1bb48.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_aKYr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/Metaflow_Logo_Horizontal_OneColor_DarkBlue_RGB.svg" alt="Metaflow Logo" class="themedImage_W2Cr themedImage--light_TfLj" height="30"><img src="/img/Metaflow_Logo_Horizontal_OneColor_White_RGB.svg" alt="Metaflow Logo" class="themedImage_W2Cr themedImage--dark_oUvU" height="30"></div></a><a class="navbar__item navbar__link navbar__link--active" href="/">Python Docs</a><a class="navbar__item navbar__link" href="/v/r">R Docs</a><a href="https://outerbounds.com/docs/admin" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Admin Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y sidebarWithHideableNavbar_FoYL"><a tabindex="-1" class="sidebarLogo_FJUI" href="/"><img src="/img/Metaflow_Logo_Horizontal_OneColor_DarkBlue_RGB.svg" alt="Metaflow Logo" class="themedImage_W2Cr themedImage--light_TfLj" height="30"><img src="/img/Metaflow_Logo_Horizontal_OneColor_White_RGB.svg" alt="Metaflow Logo" class="themedImage_W2Cr themedImage--dark_oUvU" height="30"></a><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Welcome to Metaflow</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/introduction/why-metaflow">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/getting-started/install">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/metaflow/basics">Developing with Metaflow</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/going-to-production-with-metaflow/scheduling-metaflow-flows">Going to Production with Metaflow</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active hasHref_VCh3" aria-current="page" href="/api">API Reference</a><button aria-label="Toggle the collapsible sidebar category &#x27;API Reference&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/api/client">Client API - Accessing past results</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/api/flowspec">FlowSpec - Constructing flows</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/api/current">Current - Operating a run</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/api/S3">S3 - Accessing data in S3 quickly</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/api/cards">Cards - Visualizing results</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" tabindex="0" href="/api/step-decorators">Step Decorators</a><button aria-label="Toggle the collapsible sidebar category &#x27;Step Decorators&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" tabindex="0" href="/api/flow-decorators">Flow Decorators</a><button aria-label="Toggle the collapsible sidebar category &#x27;Flow Decorators&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/metaflow-on-aws">Metaflow on AWS</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/internals-of-metaflow/technical-overview">Internals of Metaflow</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>FlowSpec - Constructing flows</h1><p>Metaflow <a href="/metaflow/basics">flows are defined</a> by inhering from the <code>FlowSpec</code> class:</p><div class="codeBlockContainer_I0IT language-python theme-code-block"><div class="codeBlockContent_wNvx python"><pre tabindex="0" class="prism-code language-python codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> metaflow </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> FlowSpec</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> step</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">MyFlow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FlowSpec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@step</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@step</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">end</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">pass</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;__main__&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MyFlow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This class has no other uses. It can&#x27;t be instantiated directly.</p><p><code>FlowSpec</code> exposes a few methods and attributes that you can use to construct a flow, which are listed below. You can add more functionality in your flows through <a href="/api/step-decorators">step-level decorators</a> and <a href="/api/flow-decorators">flow-level decorators</a>.</p><p>You can parametrize flows through the <a href="#parameters"><code>Parameter</code></a> object that are defined as class variables inside a flow. You can also include files as parameters through the <a href="#includefile"><code>IncludeFile</code></a> object.</p><p>To query and manipulate the currently executing run inside your flow, see the <a href="/api/current"><code>current</code></a> object. To access results produced by a flow, see the <a href="/api/client">Client API</a>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="defining-a-workflow">Defining a workflow<a class="hash-link" href="#defining-a-workflow" title="Direct link to heading">â€‹</a></h2><p>Annotate methods that are a part of your Metaflow workflow with <a href="/api/step-decorators/step">the <code>@step</code> decorator</a>. Use <code>FlowSpec.next</code> to define transitions between steps:</p><div class="docSection_qV9U"><a class="target_f8G0" id="FlowSpec."></a><div class="titlebox__I0_"><h4 id="FlowSpec.next"><span class="name_dFHy">FlowSpec.</span><span class="highlightedName_nmdb">next</span><span>(<!-- -->*dsts, foreach=None<!-- -->)</span></h4><a class="hash-link" href="#FlowSpec.next" title="Direct link to heading">â€‹</a><a class="source_eDXS" href="https://github.com/Netflix/metaflow/tree/master/metaflow/flowspec.py#L492">[source]</a></div><div class="content_g8IW"><div class="description_coNc"><span class="wrapper_a1qq"><p>Indicates the next step to execute after this step has completed.</p>
<p>This statement should appear as the last statement of each step, except
the end step.</p>
<p>There are several valid formats to specify the next step:</p>
<ul>
<li>
<p>Straight-line connection: <code>self.next(self.next_step)</code> where <code>next_step</code> is a method in
the current class decorated with the <code>@step</code> decorator.</p>
</li>
<li>
<p>Static fan-out connection: <code>self.next(self.step1, self.step2, ...)</code> where <code>stepX</code> are
methods in the current class decorated with the <code>@step</code> decorator.</p>
</li>
<li>
<p>Foreach branch:</p>
<pre><code>self.next(self.foreach_step, foreach='foreach_iterator')
</code></pre>
<p>In this situation, <code>foreach_step</code> is a method in the current class decorated with the
<code>@step</code> docorator and <code>foreach_iterator</code> is a variable name in the current class that
evaluates to an iterator. A task will be launched for each value in the iterator and
each task will execute the code specified by the step <code>foreach_step</code>.</p>
</li>
</ul></span></div><div class="wrapper_DVhX"><div class="paramSectionName_xY3j"><strong>Parameters<!-- -->Â </strong></div><div class="paramSectionChildren_V5gE"><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><strong>dsts</strong>: <em>Method</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>One or more methods annotated with <code>@step</code>.</p></span></div></div></div></div><div class="wrapper_DVhX"><div class="paramSectionName_xY3j"><strong>Raises<!-- -->Â </strong></div><div class="paramSectionChildren_V5gE"><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><em>InvalidNextException</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>Raised if the format of the arguments does not match one of the ones given above.</p></span></div></div></div></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="working-with-foreaches">Working with foreaches<a class="hash-link" href="#working-with-foreaches" title="Direct link to heading">â€‹</a></h2><p>Use the operations below, <code>FlowSpec.input</code>, <code>FlowSpec.index</code>, and <code>FlowSpec.foreach_stack</code> to query the status of the currently executing foreach branch. Use <code>FlowSpec.merge_artifacts()</code> to handle incoming artifacts in a join step.</p><div class="docSection_qV9U"><a class="target_f8G0" id="FlowSpec."></a><div class="titlebox__I0_"><h4 id="FlowSpec.input"><span class="name_dFHy">FlowSpec.</span><span class="highlightedName_nmdb">input</span></h4><a class="hash-link" href="#FlowSpec.input" title="Direct link to heading">â€‹</a><a class="source_eDXS" href="https://github.com/Netflix/metaflow/tree/master/">[source]</a></div><div class="content_g8IW"><div class="description_coNc"><span class="wrapper_a1qq"><p>The value of the foreach artifact in this foreach branch.</p>
<p>In a foreach step, multiple instances of this step (tasks) will be executed,
one for each element in the foreach. This property returns the element passed
to the current task. If this is not a foreach step, this returns None.</p>
<p>If you need to know the values of the parent tasks in a nested foreach, use
<code>FlowSpec.foreach_stack</code>.</p>
</span></div><div class="wrapper_DVhX"><div class="paramSectionName_xY3j"><strong>Returns<!-- -->Â </strong></div><div class="paramSectionChildren_V5gE"><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><em>object</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>Input passed to the foreach task.</p></span></div></div></div></div></div></div><div class="docSection_qV9U"><a class="target_f8G0" id="FlowSpec."></a><div class="titlebox__I0_"><h4 id="FlowSpec.index"><span class="name_dFHy">FlowSpec.</span><span class="highlightedName_nmdb">index</span></h4><a class="hash-link" href="#FlowSpec.index" title="Direct link to heading">â€‹</a><a class="source_eDXS" href="https://github.com/Netflix/metaflow/tree/master/">[source]</a></div><div class="content_g8IW"><div class="description_coNc"><span class="wrapper_a1qq"><p>The index of this foreach branch.</p>
<p>In a foreach step, multiple instances of this step (tasks) will be executed,
one for each element in the foreach. This property returns the zero based index
of the current task. If this is not a foreach step, this returns None.</p>
<p>If you need to know the indices of the parent tasks in a nested foreach, use
<code>FlowSpec.foreach_stack</code>.</p>
</span></div><div class="wrapper_DVhX"><div class="paramSectionName_xY3j"><strong>Returns<!-- -->Â </strong></div><div class="paramSectionChildren_V5gE"><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><em>int</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>Index of the task in a foreach step.</p></span></div></div></div></div></div></div><div class="docSection_qV9U"><a class="target_f8G0" id="FlowSpec."></a><div class="titlebox__I0_"><h4 id="FlowSpec.foreach_stack"><span class="name_dFHy">FlowSpec.</span><span class="highlightedName_nmdb">foreach_stack</span><span>(<!-- -->self<!-- -->)</span></h4><a class="hash-link" href="#FlowSpec.foreach_stack" title="Direct link to heading">â€‹</a><a class="source_eDXS" href="https://github.com/Netflix/metaflow/tree/master/metaflow/flowspec.py#L273">[source]</a></div><div class="content_g8IW"><div class="description_coNc"><span class="wrapper_a1qq"><p>Returns the current stack of foreach indexes and values for the current step.</p>
<p>Use this information to understand what data is being processed in the current
foreach branch. For example, considering the following code:</p>
<pre><code>@step
def root(self):
    self.split_1 = ['a', 'b', 'c']
    self.next(self.nest_1, foreach='split_1')

@step
def nest_1(self):
    self.split_2 = ['d', 'e', 'f', 'g']
    self.next(self.nest_2, foreach='split_2'):

@step
def nest_2(self):
    foo = self.foreach_stack()
</code></pre>
<p><code>foo</code> will take the following values in the various tasks for nest_2:</p>
<pre><code>    [(0, 3, 'a'), (0, 4, 'd')]
    [(0, 3, 'a'), (1, 4, 'e')]
    ...
    [(0, 3, 'a'), (3, 4, 'g')]
    [(1, 3, 'b'), (0, 4, 'd')]
    ...
</code></pre>
<p>where each tuple corresponds to:</p>
<ul>
<li>The index of the task for that level of the loop.</li>
<li>The number of splits for that level of the loop.</li>
<li>The value for that level of the loop.</li>
</ul>
<p>Note that the last tuple returned in a task corresponds to:</p>
<ul>
<li>1st element: value returned by <code>self.index</code>.</li>
<li>3rd element: value returned by <code>self.input</code>.</li>
</ul></span></div><div class="wrapper_DVhX"><div class="paramSectionName_xY3j"><strong>Returns<!-- -->Â </strong></div><div class="paramSectionChildren_V5gE"><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><em>List[Tuple[int, int, object]]</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>An array describing the current stack of foreach steps.</p></span></div></div></div></div></div></div><div class="docSection_qV9U"><a class="target_f8G0" id="FlowSpec."></a><div class="titlebox__I0_"><h4 id="FlowSpec.merge_artifacts"><span class="name_dFHy">FlowSpec.</span><span class="highlightedName_nmdb">merge_artifacts</span><span>(<span>self<!-- -->, </span><span>inputs<!-- -->, </span><span>exclude<!-- -->, </span><span>include</span>)</span></h4><a class="hash-link" href="#FlowSpec.merge_artifacts" title="Direct link to heading">â€‹</a><a class="source_eDXS" href="https://github.com/Netflix/metaflow/tree/master/metaflow/flowspec.py#L357">[source]</a></div><div class="content_g8IW"><div class="description_coNc"><span class="wrapper_a1qq"><p>Helper function for merging artifacts in a join step.</p>
<p>This function takes all the artifacts coming from the branches of a
join point and assigns them to self in the calling step. Only artifacts
not set in the current step are considered. If, for a given artifact, different
values are present on the incoming edges, an error will be thrown and the artifacts
that conflict will be reported.</p>
<p>As a few examples, in the simple graph: A splitting into B and C and joining in D:</p>
<pre><code>A:
  self.x = 5
  self.y = 6
B:
  self.b_var = 1
  self.x = from_b
C:
  self.x = from_c

D:
  merge_artifacts(inputs)
</code></pre>
<p>In D, the following artifacts are set:</p>
<ul>
<li><code>y</code> (value: 6), <code>b_var</code> (value: 1)</li>
<li>if <code>from_b</code> and <code>from_c</code> are the same, <code>x</code> will be accessible and have value <code>from_b</code></li>
<li>if <code>from_b</code> and <code>from_c</code> are different, an error will be thrown. To prevent this error,
you need to manually set <code>self.x</code> in D to a merged value (for example the max) prior to
calling <code>merge_artifacts</code>.</li>
</ul></span></div><div class="wrapper_DVhX"><div class="paramSectionName_xY3j"><strong>Parameters<!-- -->Â </strong></div><div class="paramSectionChildren_V5gE"><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><strong>inputs</strong>: <em>List[Steps]</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>Incoming steps to the join point.</p></span></div></div><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><strong>exclude</strong>: <em>List[str], optional</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>If specified, do not consider merging artifacts with a name in <code>exclude</code>.
Cannot specify if <code>include</code> is also specified.</p></span></div></div><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><strong>include</strong>: <em>List[str], optional</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>If specified, only merge artifacts specified. Cannot specify if <code>exclude</code> is
also specified.</p></span></div></div></div></div><div class="wrapper_DVhX"><div class="paramSectionName_xY3j"><strong>Raises<!-- -->Â </strong></div><div class="paramSectionChildren_V5gE"><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><em>MetaflowException</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>This exception is thrown if this is not called in a join step.</p></span></div></div><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><em>UnhandledInMergeArtifactsException</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>This exception is thrown in case of unresolved conflicts.</p></span></div></div><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><em>MissingInMergeArtifactsException</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>This exception is thrown in case an artifact specified in <code>include</code> cannot
be found.</p></span></div></div></div></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="parameters">Parameters<a class="hash-link" href="#parameters" title="Direct link to heading">â€‹</a></h2><p>The <code>Parameter</code> class is used to define parameters for a flow.</p><p>The <code>Parameter</code> objects must be defined as class variables inside a flow. The parameter values are available as read-only artifacts in all steps of the flow. For instructions, see <a href="/metaflow/basics#how-to-define-parameters-for-flows">How to define parameters for flows</a>.</p><div class="docSection_qV9U"><a class="target_f8G0"></a><div class="titlebox__I0_"><h3 id="Parameter"><span class="name_dFHy"></span><span class="highlightedName_nmdb">Parameter</span><span>(<span>name<!-- -->, </span><span>**kwargs</span>)</span></h3><a class="hash-link" href="#Parameter" title="Direct link to heading">â€‹</a><a class="source_eDXS" href="https://github.com/Netflix/metaflow/tree/master/metaflow/parameters.py#L162">[source]</a></div><div class="content_g8IW"><div class="description_coNc"><span class="wrapper_a1qq"><p>Defines a parameter for a flow.</p>
<p>Parameters must be instantiated as class variables in flow classes, e.g.</p>
<pre><code>class MyFlow(FlowSpec):
    param = Parameter('myparam')
</code></pre>
<p>in this case, the parameter is specified on the command line as</p>
<pre><code>python myflow.py run --myparam=5
</code></pre>
<p>and its value is accessible through a read-only artifact like this:</p>
<pre><code>print(self.param == 5)
</code></pre>
<p>Note that the user-visible parameter name, <code>myparam</code> above, can be
different than the artifact name, <code>param</code> above.</p>
<p>The parameter value is converted to a Python type based on the <code>type</code>
argument or to match the type of <code>default</code>, if it is set.</p></span></div><div class="wrapper_DVhX"><div class="paramSectionName_xY3j"><strong>Parameters<!-- -->Â </strong></div><div class="paramSectionChildren_V5gE"><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><strong>name</strong>: <em>str</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>User-visible parameter name.</p></span></div></div><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><strong>default</strong>: <em>str or float or int or bool or <code>JSONType</code> or a function.</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>Default value for the parameter. Use a special <code>JSONType</code> class to
indicate that the value must be a valid JSON object. A function
implies that the parameter corresponds to a <em>deploy-time parameter</em>.
The type of the default value is used as the parameter <code>type</code>.</p></span></div></div><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><strong>type</strong>: <em>type</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>If <code>default</code> is not specified, define the parameter type. Specify
one of <code>str</code>, <code>float</code>, <code>int</code>, <code>bool</code>, or <code>JSONType</code> (Default: str).</p></span></div></div><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><strong>help</strong>: <em>str</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>Help text to show in <code>run --help</code>.</p></span></div></div><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><strong>required</strong>: <em>bool</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>Require that the user specified a value for the parameter.
<code>required=True</code> implies that the <code>default</code> is not used.</p></span></div></div><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><strong>show_default</strong>: <em>bool</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>If True, show the default value in the help text (Default: True).</p></span></div></div></div></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="deploy-time-parameters">Deploy-time parameters<a class="hash-link" href="#deploy-time-parameters" title="Direct link to heading">â€‹</a></h3><p>It is possible to define the <code>default</code> value programmatically before a run or a deployment is executed through a user-defined function. For more information, see <a href="/going-to-production-with-metaflow/scheduling-metaflow-flows/scheduling-with-aws-step-functions#deploy-time-parameters">documentation for Deploy Time Parameters</a>.</p><p>For instance, the following deploy-time parameter, <code>time</code>, uses the current time as its default value:</p><div class="codeBlockContainer_I0IT language-python theme-code-block"><div class="codeBlockContent_wNvx python"><pre tabindex="0" class="prism-code language-python codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">time_now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">MyFlow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FlowSpec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    myparam </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Parameter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;time&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">type</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> default</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">time_now</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Note that if the function returns a non-string value, you must specify the parameter <code>type</code> when using deploy-time parameters, as the type of <code>default</code> can&#x27;t be inferred automatically.</p><p>The function called gets a parameter <code>context</code> that contains attributes about the current parameter which you can use to customize the value returned:</p><div class="docSection_qV9U"><a class="target_f8G0"></a><div class="titlebox__I0_"><h3 id="ParameterContext"><span class="name_dFHy"></span><span class="highlightedName_nmdb">ParameterContext</span><span>(<!-- -->)</span></h3><a class="hash-link" href="#ParameterContext" title="Direct link to heading">â€‹</a><a class="source_eDXS" href="https://github.com/Netflix/metaflow/tree/master/">[source]</a></div><div class="content_g8IW"><div class="description_coNc"><span class="wrapper_a1qq"><p>Information about the parameter being evaluated.</p>
</span></div><div class="wrapper_DVhX"><div class="paramSectionName_xY3j"><strong>Attributes<!-- -->Â </strong></div><div class="paramSectionChildren_V5gE"><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><strong>flow_name</strong>: <em>str</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>Flow name</p></span></div></div><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><strong>user_name</strong>: <em>str</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>User name</p></span></div></div><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><strong>parameter_name</strong>: <em>str</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>Parameter name</p></span></div></div></div></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="includefile">IncludeFile<a class="hash-link" href="#includefile" title="Direct link to heading">â€‹</a></h2><p>The <code>IncludeFile</code> object is a special <code>Parameter</code> that reads its value from a local file. For an example, see <a href="/metaflow/data#data-in-local-files">Data in Local Files</a>.</p><div class="docSection_qV9U"><a class="target_f8G0"></a><div class="titlebox__I0_"><h3 id="IncludeFile"><span class="name_dFHy"></span><span class="highlightedName_nmdb">IncludeFile</span><span>(<!-- -->name, **kwargs<!-- -->)</span></h3><a class="hash-link" href="#IncludeFile" title="Direct link to heading">â€‹</a><a class="source_eDXS" href="https://github.com/Netflix/metaflow/tree/master/metaflow/includefile.py#L273">[source]</a></div><div class="content_g8IW"><div class="description_coNc"><span class="wrapper_a1qq"><p>Includes a local file as a parameter for the flow.</p>
<p><code>IncludeFile</code> behaves like <code>Parameter</code> except that it reads its value from a file instead of
the command line. The user provides a path to a file on the command line. The file contents
are saved as a read-only artifact which is available in all steps of the flow.</p></span></div><div class="wrapper_DVhX"><div class="paramSectionName_xY3j"><strong>Parameters<!-- -->Â </strong></div><div class="paramSectionChildren_V5gE"><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><strong>name</strong>: <em>str</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>User-visible parameter name.</p></span></div></div><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><strong>default</strong>: <em>str</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>Default path to a local file.</p></span></div></div><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><strong>is_text</strong>: <em>bool</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>Convert the file contents to a string using the provided <code>encoding</code> (Default: True).
If False, the artifact is stored in <code>bytes</code>.</p></span></div></div><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><strong>encoding</strong>: <em>str</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>Use this encoding to decode the file contexts if <code>is_text=True</code> (default: <code>utf-8</code>).</p></span></div></div><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><strong>required</strong>: <em>bool</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>Require that the user specified a value for the parameter.
<code>required=True</code> implies that the <code>default</code> is not used.</p></span></div></div><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><strong>help</strong>: <em>str</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>Help text to show in <code>run --help</code>.</p></span></div></div><div class="parameter_UtYT"><div class="parameterName_xp1q"><span><p><strong>show_default</strong>: <em>bool</em></p></span></div><div class="parameterContent_PmvG"><span class="content_LeDY"><p>If True, show the default value in the help text (Default: True).</p></span></div></div></div></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.dev/Netflix/metaflow-docs/blob/master/docs/api/flowspec.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/api/client"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Client API - Accessing past results</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/api/current"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Current - Operating a run</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#defining-a-workflow" class="table-of-contents__link toc-highlight">Defining a workflow</a></li><li><a href="#working-with-foreaches" class="table-of-contents__link toc-highlight">Working with foreaches</a></li><li><a href="#parameters" class="table-of-contents__link toc-highlight">Parameters</a><ul><li><a href="#deploy-time-parameters" class="table-of-contents__link toc-highlight">Deploy-time parameters</a></li></ul></li><li><a href="#includefile" class="table-of-contents__link toc-highlight">IncludeFile</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.b7d466f4.js"></script>
<script src="/assets/js/main.a5c1bb48.js"></script>
</body>
</html>