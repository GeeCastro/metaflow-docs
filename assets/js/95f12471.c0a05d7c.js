"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[6021],{3905:(e,t,o)=>{o.d(t,{Zo:()=>p,kt:()=>h});var n=o(7294);function a(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){a(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t){if(null==e)return{};var o,n,a=function(e,t){if(null==e)return{};var o,n,a={},r=Object.keys(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||(a[o]=e[o]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}var s=n.createContext({}),u=function(e){var t=n.useContext(s),o=t;return e&&(o="function"==typeof e?e(t):i(i({},t),e)),o},p=function(e){var t=u(e.components);return n.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var o=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=u(o),h=a,m=d["".concat(s,".").concat(h)]||d[h]||c[h]||r;return o?n.createElement(m,i(i({ref:t},p),{},{components:o})):n.createElement(m,i({ref:t},p))}));function h(e,t){var o=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=o.length,i=new Array(r);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var u=2;u<r;u++)i[u]=o[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,o)}d.displayName="MDXCreateElement"},9659:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>u});var n=o(7462),a=(o(7294),o(3905));const r={},i="Production Deployments",l={unversionedId:"production/introduction",id:"production/introduction",title:"Production Deployments",description:"What does production mean exactly? Surely the answer depends on who you ask and what application they are working on. There are so many different",source:"@site/docs/production/introduction.md",sourceDirName:"production",slug:"/production/introduction",permalink:"/production/introduction",draft:!1,editUrl:"https://github.dev/Netflix/metaflow-docs/blob/master/docs/production/introduction.md",tags:[],version:"current",frontMatter:{},sidebar:"python",previous:{title:"Organizing Results",permalink:"/scaling/tagging"},next:{title:"Scheduling Metaflow Flows",permalink:"/production/scheduling-metaflow-flows/introduction"}},s={},u=[{value:"Reliably Running, Automated Flows",id:"reliably-running-automated-flows",level:2},{value:"Patterns of production deployments",id:"patterns-of-production-deployments",level:3},{value:"To Production And Back",id:"to-production-and-back",level:2},{value:"What You Will Learn",id:"what-you-will-learn",level:2}],p={toc:u};function c(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,n.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"production-deployments"},"Production Deployments"),(0,a.kt)("p",null,"What does ",(0,a.kt)("em",{parentName:"p"},"production")," mean exactly? Surely the answer depends on who you ask and what application they are working on. There are so many different\nways to produce business value with machine learning and data science that there can't be a single unambiguous definition or a way to deploy\nprojects to production."),(0,a.kt)("p",null,"However, there are characteristics that are common to all production deployments:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Production deployments should ",(0,a.kt)("strong",{parentName:"p"},"run without human intervention"),". It is not very practical to use results that require you to execute ",(0,a.kt)("inlineCode",{parentName:"p"},"run"),"\non your laptop to power serious business processes or products.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Production deployments should ",(0,a.kt)("strong",{parentName:"p"},"run reliably")," in a highly available manner. Results should appear predictably, even if infrastructure encounters spurious failures."))),(0,a.kt)("p",null,"Consider the Metaflow journey"),(0,a.kt)("p",null,(0,a.kt)("img",{src:o(7195).Z,width:"703",height:"540"})),(0,a.kt)("p",null,"Thus far the steps have involved a human in the loop, from ",(0,a.kt)("a",{parentName:"p",href:"/metaflow/introduction"},"local development")," to ",(0,a.kt)("a",{parentName:"p",href:"/scaling/introduction"},"scalable flows"),".\nIn contrast, a defining feature of production deployments is that they are fully automated. We achieve this by ",(0,a.kt)("em",{parentName:"p"},"scheduling flows")," to run automatically on\n",(0,a.kt)("em",{parentName:"p"},"a production-grade workflow orchestrator"),", so you don't need to write ",(0,a.kt)("inlineCode",{parentName:"p"},"run")," manually to produce the desired results."),(0,a.kt)("h2",{id:"reliably-running-automated-flows"},"Reliably Running, Automated Flows"),(0,a.kt)("p",null,"What about the second characteristic of production deployments - reliability? Firstly, a big benefit of ",(0,a.kt)("a",{parentName:"p",href:"/scaling/introduction"},"Stage II")," is that you can\ntest your workflows at scale, and add ",(0,a.kt)("a",{parentName:"p",href:"/scaling/failures"},"reliability-enhancing")," ",(0,a.kt)("a",{parentName:"p",href:"/scaling/dependencies"},"features"),", making sure your flows can cope with\nproduction-scale workloads. Secondly, your flow needs to be orchestrated by a system that by itself runs reliably, which is ",(0,a.kt)("a",{parentName:"p",href:"https://netflixtechblog.com/unbundling-data-science-workflows-with-metaflow-and-aws-step-functions-d454780c6280"},"harder than it sounds"),". Such a production-grade orchestrator needs to be"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Highly available"),": The orchestrator itself must not crash, even if a server it runs on hits a random failure.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Highly scalable"),": We shouldn't have to worry about the number flows orchestrated by the system.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Capable of triggering flows based on different conditions"),": We should be able to automate flow execution flexibly.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Easy to monitor and operate"),": To minimize the time spent on occasional human interventions."))),(0,a.kt)("p",null,"Fortunately, a few systems are able to fulfill these requirements, judging by their track record. Metaflow integrates with two of them:\n",(0,a.kt)("a",{parentName:"p",href:"https://argoproj.github.io/argo-workflows/"},"Argo Workflows")," that runs on Kubernetes and ",(0,a.kt)("a",{parentName:"p",href:"https://aws.amazon.com/step-functions/"},"AWS Step Functions"),",\na managed service by AWS."),(0,a.kt)("p",null,"In addition, Metaflow integrates with a popular open-source workflow orchestrator, ",(0,a.kt)("a",{parentName:"p",href:"https://airflow.apache.org/"},"Apache Airflow"),". While Airflow has\nmore limitations than the two aforementioned orchestrators, it is a good choice if you have many DAGs deployed on it already and you don't want to\nintroduce a new orchestrator in your environment."),(0,a.kt)("p",null,"While all of these systems are quite complex under the hood, Metaflow makes using them trivial:\nYou can deploy your flows literally with a single command - no changes in the code required. Also, this means that you can switch between schedulers\neasily. For instance, you can start with Apache Airflow to stay compatible with your existing data pipelines and migrate to Argo Workflows over time\nwithout having to pay any migration tax."),(0,a.kt)("h3",{id:"patterns-of-production-deployments"},"Patterns of production deployments"),(0,a.kt)("p",null,"Once flows run reliably, you can leverage the results - like freshly trained models - on various systems:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"You can write fresh predictions or other results in a data warehouse, e.g. to power a dashboard."),(0,a.kt)("li",{parentName:"ol"},"You can populate fresh results in a cache e.g. for a recommendation system."),(0,a.kt)("li",{parentName:"ol"},"You can deploy models on a ",(0,a.kt)("em",{parentName:"li"},"model hosting")," platform of your choosing, e.g. ",(0,a.kt)("a",{parentName:"li",href:"https://www.seldon.io/"},"Seldon")," or ",(0,a.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/sagemaker/latest/dg/how-it-works-deployment.html"},"AWS Sagemaker"),".")),(0,a.kt)("p",null,"The exact pattern depends on your use case. Importantly, creating these integrations become much easier when you can trust your flows to run reliably. We are happy to help\nyou on ",(0,a.kt)("a",{parentName:"p",href:"http://slack.outerbounds.co"},"the Metaflow support Slack")," to find a pattern that works for your needs."),(0,a.kt)("h2",{id:"to-production-and-back"},"To Production And Back"),(0,a.kt)("p",null,"While the journey illustration above looks like a linear path from prototype to production, realistically the picture should illustrate loops everywhere. In particular, there is\nconstant interaction between local development and production deployments, as you troubleshoot production issues (inevitably), as well as keep working on newer versions of flows. "),(0,a.kt)("p",null,"When it comes to troubleshooting, a hugely convenient feature is the ability to ",(0,a.kt)("a",{parentName:"p",href:"/metaflow/debugging#reproducing-production-issues-locally"},(0,a.kt)("inlineCode",{parentName:"a"},"resume")," failed production runs locally"),".\nAlso, remember that you can inspect the state of any production run with ",(0,a.kt)("a",{parentName:"p",href:"/metaflow/visualizing-results"},"cards")," and ",(0,a.kt)("a",{parentName:"p",href:"/metaflow/client"},"notebooks"),", in real-time."),(0,a.kt)("p",null,"When it comes to working on newer versions, how do you know if a newer version performs better than the latest production deployment? Often, the best way to answer the question is\nto deploy the new version to run concurrently with the existing production version and compare the results, as in an A/B test.\nThis pattern is enabled by ",(0,a.kt)("a",{parentName:"p",href:"coordinating-larger-metaflow-projects"},"the ",(0,a.kt)("inlineCode",{parentName:"a"},"@project")," decorator"),". Also, ",(0,a.kt)("a",{parentName:"p",href:"https://outerbounds.com/blog/five-ways-to-use-the-new-metaflow-tags/"},"Metaflow tags"),"\ncome in handy when designing processes around production deployments."),(0,a.kt)("h2",{id:"what-you-will-learn"},"What You Will Learn"),(0,a.kt)("p",null,"In this section, you will learn how to make your flows run automatically without any human intervention. "),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"/production/scheduling-metaflow-flows/introduction"},"Scheduling Metaflow flows"),".",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Depending on the ",(0,a.kt)("a",{parentName:"li",href:"/getting-started/infrastructure"},"infrastructure you have installed"),", pick a section below:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/production/scheduling-metaflow-flows/scheduling-with-argo-workflows"},"Scheduling flows with Argo Workflows")," - choose this if running on Kubernetes."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/production/scheduling-metaflow-flows/scheduling-with-aws-step-functions"},"Scheduling flows with AWS Step Functions")," - choose for minimal operational overhead."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/production/scheduling-metaflow-flows/scheduling-with-airflow"},"Scheduling flows with Apache Airflow")," - choose to stay compatible with your existing Airflow deployment."))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"/production/coordinating-larger-metaflow-projects"},"Coordinating larger Metaflow projects")," to enable multiple parallel production deployments.")))}c.isMDXComponent=!0},7195:(e,t,o)=>{o.d(t,{Z:()=>n});const n=o.p+"assets/images/intro-cartoon-3-ac6f165bca661f279d06c6f06a04ac2a.svg"}}]);