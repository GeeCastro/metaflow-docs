<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EYFXNGNGB6"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-EYFXNGNGB6",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Metaflow Docs" href="/opensearch.xml"><title data-react-helmet="true">Debugging with Metaflow | Metaflow Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://docs.metaflow.org/img/Metaflow_Logo_Vertical_FullColor_Ribbon_Dark_RGB.png"><meta data-react-helmet="true" name="twitter:image" content="https://docs.metaflow.org/img/Metaflow_Logo_Vertical_FullColor_Ribbon_Dark_RGB.png"><meta data-react-helmet="true" property="og:url" content="https://docs.metaflow.org/metaflow/debugging"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Debugging with Metaflow | Metaflow Docs"><meta data-react-helmet="true" name="description" content="Metaflow wants to make debugging failed flows as painless as possible."><meta data-react-helmet="true" property="og:description" content="Metaflow wants to make debugging failed flows as painless as possible."><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.metaflow.org/metaflow/debugging"><link data-react-helmet="true" rel="alternate" href="https://docs.metaflow.org/metaflow/debugging" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.metaflow.org/metaflow/debugging" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://5IZ8L9TJQL-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.eb8bddc4.css">
<link rel="preload" href="/assets/js/runtime~main.2de01561.js" as="script">
<link rel="preload" href="/assets/js/main.a5c1bb48.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_aKYr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/Metaflow_Logo_Horizontal_OneColor_DarkBlue_RGB.svg" alt="Metaflow Logo" class="themedImage_W2Cr themedImage--light_TfLj" height="30"><img src="/img/Metaflow_Logo_Horizontal_OneColor_White_RGB.svg" alt="Metaflow Logo" class="themedImage_W2Cr themedImage--dark_oUvU" height="30"></div></a><a class="navbar__item navbar__link navbar__link--active" href="/">Python Docs</a><a class="navbar__item navbar__link" href="/v/r">R Docs</a><a href="https://outerbounds.com/docs/admin" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Admin Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y sidebarWithHideableNavbar_FoYL"><a tabindex="-1" class="sidebarLogo_FJUI" href="/"><img src="/img/Metaflow_Logo_Horizontal_OneColor_DarkBlue_RGB.svg" alt="Metaflow Logo" class="themedImage_W2Cr themedImage--light_TfLj" height="30"><img src="/img/Metaflow_Logo_Horizontal_OneColor_White_RGB.svg" alt="Metaflow Logo" class="themedImage_W2Cr themedImage--dark_oUvU" height="30"></a><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Welcome to Metaflow</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/introduction/why-metaflow">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/getting-started/install">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" href="/metaflow/basics">Developing with Metaflow</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/metaflow/basics">Basics of Metaflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/metaflow/client">Inspecting Flows and Results</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" tabindex="0" href="/metaflow/visualizing-results">Visualizing Results</a><button aria-label="Toggle the collapsible sidebar category &#x27;Visualizing Results&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/metaflow/debugging">Debugging with Metaflow</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" tabindex="0" href="/metaflow/scaling-out-and-up">Scaling Out and Up</a><button aria-label="Toggle the collapsible sidebar category &#x27;Scaling Out and Up&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/metaflow/data">Loading and Storing Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/metaflow/dependencies">Managing External Libraries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/metaflow/failures">Dealing with Failures</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/metaflow/tagging">Organizing Results</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/going-to-production-with-metaflow/scheduling-metaflow-flows">Going to Production with Metaflow</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/api">API Reference</a><button aria-label="Toggle the collapsible sidebar category &#x27;API Reference&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/metaflow-on-aws">Metaflow on AWS</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/internals-of-metaflow/technical-overview">Internals of Metaflow</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Debugging with Metaflow</h1><p>Metaflow wants to make debugging failed flows as painless as possible.</p><p>Debugging issues during development is a normal part of the development process. You should be able to develop and debug your Metaflow scripts similar to how you develop any Python scripts locally.</p><p>Debugging a failure can either happen <strong>after</strong> a failed execution or <strong>during</strong> execution. In the first case, Metaflow provides two mechanisms:</p><ul><li>the <a href="/metaflow/debugging#how-to-debug-failed-flows">ability to resume a flow</a>, re-executing all successful steps and only re-executing from the failed step. This allows you to fix the problem in the failed step, resume the flow and make progress.</li><li>the <a href="/metaflow/debugging#inspecting-data-with-a-notebook">ability to inspect the data</a> produced by each step in a flow to be able to determine what went wrong.</li></ul><p>In the second case, Metaflow is also compatible (at least when executing locally) with <a href="/metaflow/debugging#debugging-your-flow-code">debuggers</a> which allow you to set breakpoints inside your step code. You will then be able to inspect and modify state and step through your code line-by-line to determine where the problem is.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="how-to-debug-failed-flows">How to debug failed flows<a class="hash-link" href="#how-to-debug-failed-flows" title="Direct link to heading">â€‹</a></h2><p>The process of debugging failed flows is similar both for development-time and production-time issues:</p><ol><li>Identify the step that failed. The failed step is reported as the last line of the error report where it is easy to spot.</li><li>Identify the run id of the failed run. On the console output, each line is prefixed with an identifier like <code>2/start/21426</code>. Here, <code>2</code> is the run id, <code>start</code> is the step name, and <code>21426</code> is the task id.</li><li>Reproduce the failed run with <code>resume</code> as <a href="/metaflow/debugging#how-to-use-the-resume-command">described below</a>. Confirm that the error message you get locally matches to the original error message.</li><li>Identify the failed logic inside the failed step. You can do this by adding <code>print</code> statements in the step until <code>resume</code> reveals enough information. Alternatively, you can reproduce the faulty logic in a notebook using input data artifacts for the step, as described below in the section about <a href="/metaflow/debugging#inspecting-data-with-a-notebook">notebooks</a>.</li><li>Confirm that the fix works with <code>resume</code>. Return to 4 if the error has not been fixed.</li><li>When the step works locally, rerun the whole flow from <code>start</code> to <code>end</code> and confirm that the fix works as intended.</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="how-to-use-the-resume-command">How to use the <code>resume</code> command<a class="hash-link" href="#how-to-use-the-resume-command" title="Direct link to heading">â€‹</a></h3><p>The <code>resume</code> command allows you to resume execution of a past run at a failed step. Resuming makes it easy to quickly reproduce the failure and iterate on the step code until a fix has been found.</p><p>Here is how it works. First, save the snippet below :</p><div class="codeBlockContainer_I0IT language-python theme-code-block"><div class="codeBlockContent_wNvx python"><pre tabindex="0" class="prism-code language-python codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> metaflow </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> FlowSpec</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> step</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">DebugFlow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FlowSpec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@step</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@step</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">a</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@step</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">b</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;2fail&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@step</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> inputs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;a is %s&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> inputs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;b is %s&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> inputs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;total is %d&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token builtin">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">input</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token builtin">input</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> inputs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@step</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">end</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">pass</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;__main__&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DebugFlow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Run the script with:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">python debug.py run</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The run should fail. The output should look like:</p><div class="codeBlockContainer_I0IT language-python theme-code-block"><div class="codeBlockContent_wNvx python"><pre tabindex="0" class="prism-code language-python codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2018</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">01</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">27</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">22</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">59</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">40.313</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">b</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">21638</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pid </span><span class="token number" style="color:#36acaa">13720</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> File </span><span class="token string" style="color:#e3116c">&quot;debug.py&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> line </span><span class="token number" style="color:#36acaa">17</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2018</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">01</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">27</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">22</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">59</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">40.313</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">b</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">21638</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pid </span><span class="token number" style="color:#36acaa">13720</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;2fail&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2018</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">01</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">27</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">22</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">59</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">40.314</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">b</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">21638</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pid </span><span class="token number" style="color:#36acaa">13720</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> ValueError</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> invalid literal </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> base </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2fail&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2018</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">01</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">27</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">22</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">59</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">40.314</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">b</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">21638</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pid </span><span class="token number" style="color:#36acaa">13720</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2018</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">01</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">27</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">22</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">59</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">40.361</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">a</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">21637</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pid </span><span class="token number" style="color:#36acaa">13719</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Task finished successfully</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2018</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">01</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">27</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">22</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">59</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">40.362</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">b</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">21638</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pid </span><span class="token number" style="color:#36acaa">13720</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Task failed</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2018</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">01</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">27</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">22</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">59</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">40.362</span><span class="token plain"> Workflow failed</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Step failure</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Step b </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task</span><span class="token operator" style="color:#393A34">-</span><span class="token builtin">id</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">21638</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> failed</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This shows that the step <code>b</code> of the run <code>3</code> failed. In your case, the run id could be different.</p><p>The <code>resume</code> command runs the flow similar to <code>run</code>. However, in contrast to <code>run</code> resuming reuses results of every successful step instead of actually running them.</p><p>Try it with</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">python debug.py resume</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Metaflow remembers the run number of the last local run, which in this case is <code>3</code>, so you should see <code>resume</code> reusing results of the run above. Since we have not changed anything yet, you should see the above error again but with an incremented run number.</p><p>You can also resume a specific run using the CLI option <code>--origin-run-id</code> if you don&#x27;t like the default value selected by Metaflow. To get the same behavior as above, you can also do:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">python debug.py resume --origin-run-id </span><span class="token number" style="color:#36acaa">3</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>If you&#x27;d like programmatic access to the <code>--origin-run-id</code> selected for the <code>resume</code> (either implicitly selected by Metaflow as last <code>run</code> invocation, or explicitly declared by the user via the CLI), you can use the <code>current</code> singleton. Read more <a href="/metaflow/tagging#accessing-current-ids-in-a-flow">here</a>.</p><p>Next, fix the error by replacing <code>int(&#x27;2fail&#x27;)</code> in <code>debug.py</code> with <code>int(&#x27;2&#x27;)</code>. Try again after the fix. This time, you should see the flow completing successfully.</p><p>Resuming uses the flow and step names to decide what results can be reused. This means that the results of previously successful steps will get reused even if you change their step code. You can add new steps and alter code of failed steps safely with <code>resume</code></p><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="resuming-from-an-arbitrary-step">Resuming from an arbitrary step<a class="hash-link" href="#resuming-from-an-arbitrary-step" title="Direct link to heading">â€‹</a></h4><p>By default, <code>resume</code> resumes from the step that failed, like <code>b</code> above. Sometimes fixing the failed step requires re-execution of some steps that precede it.</p><p>You can choose the step to resume from by specifying the step name on the command line:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">python debug.py resume start</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This would resume execution from the step <code>start</code>. If you specify a step that comes after the step that failed, execution resumes from the failed step - you can&#x27;t skip over steps.</p><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="resume-and-parameters">Resume and parameters<a class="hash-link" href="#resume-and-parameters" title="Direct link to heading">â€‹</a></h4><p>If your flow has <a href="/metaflow/basics#how-to-define-parameters-for-flows"><code>Parameters</code></a>, you can&#x27;t change their values when resuming. Changing parameter values could change the results of any steps, including those that <code>resume</code> skips over, which could result to unexpected behavior in subsequent steps.</p><p>The <code>resume</code> command reuses the parameter values that you set with <code>run</code> originally.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="reproducing-production-issues-locally">Reproducing production issues locally<a class="hash-link" href="#reproducing-production-issues-locally" title="Direct link to heading">â€‹</a></h2><p>This section shows you how to reproduce a failed Metaflow run on <a href="/metaflow/debugging#reproducing-failed-aws-step-functions-executions">AWS Step Functions</a> or <a href="/metaflow/debugging#reproducing-failed-argo-workflows-executions">Argo Workflows</a> locally. </p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="reproducing-failed-aws-step-functions-executions">Reproducing failed AWS Step Functions executions<a class="hash-link" href="#reproducing-failed-aws-step-functions-executions" title="Direct link to heading">â€‹</a></h3><p>This is how a failed run on AWS Step Functions UI looks like -</p><p><img src="/assets/images/image1-accbb36a62286f898ffc47fe5c0ea1f3.png" width="1999" height="180"></p><p><img src="/assets/images/image3_(1)-0fa449301236d6773f122388d74743a0.png" width="1999" height="1009"></p><p>Notice the execution ID of <code>5ca85f96-8508-409d-a5f5-b567db1040c5</code>. When running on AWS Step Functions, Metaflow uses the AWS Step Functions execution ID (prefixed with <code>sfn-</code>) as the run id.</p><p>The graph visualization shows that step <code>b</code> failed, as expected. First, you should inspect the logs of the failed step to get an idea of why it failed. You can access AWS Batch step logs in the AWS Step Functions UI by looking for the <code>JobId</code> in the <code>Error</code> blob that can be accessed by clicking on the <code>Exception</code> pane on the right side of the UI. You can use this <code>JobId</code> in the AWS Batch console to check the job logs. This <code>JobId</code> is also the metaflow task ID for the step.</p><p>Next, we want to reproduce the above error locally. We do this by resuming the specific AWS Step Functions run that failed:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">python debug.py resume --origin-run-id sfn-5ca85f96-8508-409d-a5f5-b567db1040c5</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This will reuse the results of the <code>start</code> and <code>a</code> step from the AWS Step Functions run. It will try to rerun the step <code>b</code> locally, which fails with the same error as it does in production.</p><p>You can fix the error locally as above. In the case of this simple flow, you can run the whole flow locally to confirm that the fix works. After validating the results, you would deploy a new version to production with <code>step-functions create</code>.</p><p>However, this might not be a feasible approach for complex production flow. For instance, the flow might process large amounts of data that can not be handled in your local instance. We have better approaches for staging flows for production:</p><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="staging-flows-for-production">Staging flows for production<a class="hash-link" href="#staging-flows-for-production" title="Direct link to heading">â€‹</a></h4><p>The easiest approach to test a demanding flow is to run it with AWS Batch. This works even with resume:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">python debug.py resume --origin-run-id sfn-5ca85f96-8508-409d-a5f5-b567db1040c5 --with batch</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This will resume your flow and run every step on AWS Batch. When you are ready to test a fixed flow end-to-end, just run it as follows:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">python debug.py run --with batch</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Alternatively, you can change the name of the flow temporarily, e.g. from DebugFlow to DebugFlowStaging. Then you can run <code>step-functions create</code> with the new name, which will create a separate staging flow on AWS Step Functions. You can also use the <a href="/going-to-production-with-metaflow/coordinating-larger-metaflow-projects#the-project-decorator"><code>@project</code></a> decorator.</p><p>You can test the staging flow freely without interfering with the production flow. Once the staging flow runs successfully, you can confidently deploy a new version to production.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="reproducing-failed-argo-workflows-executions">Reproducing failed Argo Workflows executions<a class="hash-link" href="#reproducing-failed-argo-workflows-executions" title="Direct link to heading">â€‹</a></h3><p>This is how a failed run on Argo Workflows UI looks like -</p><p><img src="/assets/images/argo-ui-fail-fe220e9ecb225199ad3afca7355e55eb.png" width="1600" height="912"></p><p>Notice the execution ID of <code>branchflow-r8qcn</code>. When running on Argo Workflows, Metaflow uses the Argo Workflows <em>workflow execution</em> name (prefixed with <code>argo-</code>) as the run id.</p><p>The graph visualization shows that step <code>b</code> failed, as expected. First, you should inspect the logs of the failed step to get an idea of why it failed. You can access Kubernetes step logs in the Argo Workflows UI by selecting the failed task and clicking on the logs button. </p><p>Next, we want to reproduce the above error locally. We do this by resuming the specific Argo Workflows run that failed:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">python debug.py resume --origin-run-id argo-branchflow-r8qcn</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This will reuse the results of the <code>start</code> and <code>a</code> step from the Argo Workflows run. It will try to rerun the step <code>b</code> locally, which fails with the same error as it does in production.</p><p>You can fix the error locally as above. In the case of this simple flow, you can run the whole flow locally to confirm that the fix works. After validating the results, you would deploy a new version to production with <code>argo-workflows create</code>.</p><p>However, this might not be a feasible approach for complex production flow. For instance, the flow might process large amounts of data that can not be handled in your local instance. We have better approaches for staging flows for production:</p><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="staging-flows-for-production-1">Staging flows for production<a class="hash-link" href="#staging-flows-for-production-1" title="Direct link to heading">â€‹</a></h4><p>The easiest approach to test a demanding flow is to run it with Kubernetes. This works even with resume:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">python debug.py resume --origin-run-id argo-branchflow-r8qcn --with kubernetes</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This will resume your flow and run every step on Kubernetes. When you are ready to test a fixed flow end-to-end, just run it as follows:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">python debug.py run --with kubernetes</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Alternatively, you can change the name of the flow temporarily, e.g. from DebugFlow to DebugFlowStaging. Then you can run <code>argo-workflows create</code> with the new name, which will create a separate staging flow on Argo Workflows. You can also use the <a href="/going-to-production-with-metaflow/coordinating-larger-metaflow-projects#the-project-decorator"><code>@project</code></a> decorator.</p><p>You can test the staging flow freely without interfering with the production flow. Once the staging flow runs successfully, you can confidently deploy a new version to production.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="inspecting-data-with-a-notebook">Inspecting data with a notebook<a class="hash-link" href="#inspecting-data-with-a-notebook" title="Direct link to heading">â€‹</a></h2><p>The above example demonstrates a trivial error. In the real life, errors can be much trickier to debug. In the case of machine learning, a flow may fail because of an unexpected distribution of input data, although nothing is wrong with the code per se.</p><p>Being able to inspect data produced by every step is a powerful feature of Metaflow which can help in situations like this.</p><p>This clip (no audio) demonstrates inspecting values in a flow:</p><div style="position:relative;width:100%;height:500px"><iframe src="https://cdn.iframe.ly/3Ffh7OX" style="top:0;left:0;width:100%;height:100%;position:absolute;border:0" allowfullscreen="" scrolling="no" allow="accelerometer *; clipboard-write *; encrypted-media *; gyroscope *; picture-in-picture *;"></iframe></div><p>In the above clip, you will see:</p><ol><li>In the flow from the <a href="/getting-started/tutorials">tutorials</a> (<a href="/getting-started/tutorials/season-1-the-local-experience/episode01">Episode 1</a>), the <code>genre_movies</code> step calculates an artifact <code>movies</code>. We are going to demonstrate how this artifact can be inspected after the flow has executed;</li><li>In a Jupyter notebook, you can list all the flows and select the latest run of the Episode 1 flow;</li><li>Further, you can select the <code>genre_movies</code> step from this flow and inspect its value. As you can see, the value computed at that step is fully available via the <a href="/metaflow/client">Client API</a> and this works for any completed step even steps that completed successfully in a failed run.</li></ol><p>For more details about the notebook API, see the <a href="/metaflow/client">Client API</a>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="debugging-your-flow-code-using-an-ide">Debugging your Flow code using an IDE<a class="hash-link" href="#debugging-your-flow-code-using-an-ide" title="Direct link to heading">â€‹</a></h2><p>If anything fails in your code, Metaflow prints out the normal Python stack trace showing the line of code that caused the error. Typically, this error message provides enough information so you can fix the code using your favorite editor.</p><p>Alternatively, you can use a built-in debugger available in many modern IDEs. Since Metaflow uses subprocesses to launch steps, the IDE may need some additional configuration to handle this properly. We detail the configuration for two popular IDEs here. Other IDEs may also work similarly - let us know and we can add information about your favorite tool.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="debugging-with-pycharm">Debugging with PyCharm<a class="hash-link" href="#debugging-with-pycharm" title="Direct link to heading">â€‹</a></h3><p>The following steps will allow you to debug your Flow within PyCharm:</p><ol><li>In the &quot;Run&quot; menu, select &quot;Edit Configurations...&quot;</li><li>Create a new configuration with the following items:<ol><li>Set the &quot;Script path&quot; field to point to the absolute path of your Flow script</li><li>Set the &quot;Parameters&quot; field to &quot;run&quot;</li><li>Set the &quot;Working directory&quot; field to the directory containing your Flow script</li></ol></li><li>You can now set your breakpoints as usual in your Flow code and select &quot;Debug&quot; from the &quot;Run&quot; menu.</li></ol><p>Note that since Metaflow may launch multiple steps in parallel, you may actually hit multiple breakpoints at the same time; you will be able to switch between those breakpoints using the drop down menu (it will say &quot;MainThread&quot;). You can also restrict Metaflow to only execute one step at a time by adding &quot;--max-workers 1&quot; to the &quot;Parameters&quot; field.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="debugging-with-vscode">Debugging with VSCode<a class="hash-link" href="#debugging-with-vscode" title="Direct link to heading">â€‹</a></h3><p>You can enable debugging of a Flow in VSCode by adjusting your project&#x27;s configuration in <code>.vscode/launch.json</code>.</p><p>Here is a recording of the end-to-end setup proccess:</p><div style="width:640px;height:360px"></div><p>The configuration file as illustrated in the recording is provided below. Make sure you are extra careful to update the json structure appropriately if you already have existing settings.</p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0.2.0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;configurations&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Metaflow Debug&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;python&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;request&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;launch&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;program&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;${file}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;args&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;run&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;env&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-property property" style="color:#36acaa">&quot;USERNAME&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;hamel&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;subProcess&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">&quot;console&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;integratedTerminal&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You can now set breakpoints and then select &quot;Start Debugging&quot; from the &quot;Debug&quot; menu or command pallete as illustrated in the recording. Note that since Metaflow may launch multiple steps in parallel, you may actually hit multiple breakpoints at the same time; you will be able to switch between those breakpoints by selecting the proper function stack in the &quot;Call Stack&quot; window. You can also restrict Metaflow to only execute one step at a time by adding the values &quot;--max-workers&quot; and &quot;1&quot; to the &quot;args&quot; array in the configuration.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="combining-debugging-with-resume">Combining debugging with resume<a class="hash-link" href="#combining-debugging-with-resume" title="Direct link to heading">â€‹</a></h3><p>You can naturally combine the techniques described in this section with the &quot;resume&quot; command described previously. Instead of passing &quot;run&quot; as the program argument, simply pass &quot;resume&quot;.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="compatibility-with-conda-decorator">Compatibility with Conda decorator<a class="hash-link" href="#compatibility-with-conda-decorator" title="Direct link to heading">â€‹</a></h3><p>The above instructions work even if you use <a href="/metaflow/dependencies#managing-dependencies-with-conda-decorator"><code>@conda</code> decorators</a> in your code; you need, however, to ensure that the <code>conda</code> binary is available in your <code>PATH</code>. The easiest way to do this is to set the <code>PATH</code> environment variable to properly include the path to the <code>conda</code> binary if it is in a non-standard location. In VSCode, you can simply add this value in the env section of launch.json and in PyCharm, the UI allows you to set environment variables.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.dev/Netflix/metaflow-docs/blob/master/docs/metaflow/debugging.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/metaflow/visualizing-results/advanced-shareable-cards-with-card-templates"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Advanced, Shareable Cards with Card Templates</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/metaflow/scaling-out-and-up"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Scaling Out and Up</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#how-to-debug-failed-flows" class="table-of-contents__link toc-highlight">How to debug failed flows</a><ul><li><a href="#how-to-use-the-resume-command" class="table-of-contents__link toc-highlight">How to use the <code>resume</code> command</a></li></ul></li><li><a href="#reproducing-production-issues-locally" class="table-of-contents__link toc-highlight">Reproducing production issues locally</a><ul><li><a href="#reproducing-failed-aws-step-functions-executions" class="table-of-contents__link toc-highlight">Reproducing failed AWS Step Functions executions</a></li><li><a href="#reproducing-failed-argo-workflows-executions" class="table-of-contents__link toc-highlight">Reproducing failed Argo Workflows executions</a></li></ul></li><li><a href="#inspecting-data-with-a-notebook" class="table-of-contents__link toc-highlight">Inspecting data with a notebook</a></li><li><a href="#debugging-your-flow-code-using-an-ide" class="table-of-contents__link toc-highlight">Debugging your Flow code using an IDE</a><ul><li><a href="#debugging-with-pycharm" class="table-of-contents__link toc-highlight">Debugging with PyCharm</a></li><li><a href="#debugging-with-vscode" class="table-of-contents__link toc-highlight">Debugging with VSCode</a></li><li><a href="#combining-debugging-with-resume" class="table-of-contents__link toc-highlight">Combining debugging with resume</a></li><li><a href="#compatibility-with-conda-decorator" class="table-of-contents__link toc-highlight">Compatibility with Conda decorator</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.2de01561.js"></script>
<script src="/assets/js/main.a5c1bb48.js"></script>
</body>
</html>